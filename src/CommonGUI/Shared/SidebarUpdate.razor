@using BriefingRoom4DCS.UpdateService
@inject BriefingRoom4DCS.IBriefingRoom briefingRoom
@inject IJSRuntime JSRuntime

@if (!BriefingRoom.RUNNING_IN_DOCKER && (Layout?.NewerMainRelease != null || Layout.NewerBetaRelease != null))
{
    <div class="sidebar-update">
        @if (Layout.IsUpdating)
        {
            <div class="update-progress">
                <div class="progress" style="height: 4px;">
                    <div class="progress-bar" role="progressbar" style="width: @Layout.DownloadProgress%"></div>
                </div>
                <small class="update-status">@Layout.UpdateStatus</small>
            </div>
        }
        else if (!string.IsNullOrEmpty(Layout.DownloadErrorMessage))
        {
            <small class="text-danger">@Layout.DownloadErrorMessage</small>
        }
        else
        {
            @if (Layout.NewerMainRelease != null)
            {
                <div class="update-available">
                    <span class="oi oi-cloud-download update-icon" title="@briefingRoom.Translate("NewReleaseAvailable")"></span>
                    <div class="update-info">
                        <a href="@Layout.NewerMainRelease.HtmlUrl" target="_blank" class="update-version"
                               title="@Layout.NewerMainRelease.Name">
                            @Layout.NewerMainRelease.Name
                        </a>
                        <button class="btn btn-sm btn-primary update-btn" @onclick="() => Layout.StartUpdateAsync(false)">
                            @briefingRoom.Translate("UpdateNow")
                        </button>
                    </div>
                </div>
            }
            @if (Layout.NewerBetaRelease != null)
            {
                <div class="update-available beta">
                    <span class="oi oi-beaker update-icon" title="@briefingRoom.Translate("BetaReleaseAvailable")"></span>
                    <div class="update-info">
                        <a href="@Layout.NewerBetaRelease.HtmlUrl" target="_blank" class="update-version"
                               title="@Layout.NewerBetaRelease.Name">
                            Beta: @Layout.NewerBetaRelease.Name
                        </a>
                        <button class="btn btn-sm btn-warning update-btn" @onclick="() => Layout.StartUpdateAsync(true)">
                            @briefingRoom.Translate("UpdateNow")
                        </button>
                    </div>
                </div>
            }
        }
    </div>
}

@code {
    [CascadingParameter]
    public MainLayout Layout { get; set; }
}